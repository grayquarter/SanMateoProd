var Dpr=Dpr||{};!function(){function loadLibrary(){eval(loadScript("INCLUDES_DPR_LIBRARY")),Dpr.init(!0)}function loadScript(e){return e=e.toUpperCase(),aa.proxyInvoker.newInstance("com.accela.aa.emse.emse.EMSEBusiness").getOutput().getScriptByPK(aa.getServiceProviderCode(),e,"ADMIN").getScriptText()+""}function getProjectType(e){var t=aa.cap.getCap(e).getOutput().getCapType().toString()+"",e=aa.bizDomain.getBizDomainByValue("DPR_RECORD_TYPES_ENABLED",t);if(e.getSuccess()){e=e.getOutput();return"A"==e.getAuditStatus()+""?{id:t,raw:e.getDescription()}:null}return null}function isProject(e){return null!==getProjectType(e)}function fireAction(e){function t(e){var t=aa.env.getValue("CurrentUserID")+"";if(!t)return Dpr.error("No user for transaction."),null;var a,r,n,i,o,u,n=(i=aa.env.getValue("PermitId1"),o=aa.env.getValue("PermitId2"),u=aa.env.getValue("PermitId3"),i&&o&&u&&(o+="",u+="",(i+="").length&&o.length&&u.length&&((n=aa.cap.getCapID(i,o,u)).getSuccess()?s=n.getOutput():Dpr.error("capId not found: "+n.getErrorMessage()))),s||(a=aa.env.getValue("CapId"))&&(a+="").length&&(r=a.split("-"),(n=aa.cap.getCapID(r[0],r[1],r[2])).getSuccess()?s=n.getOutput():Dpr.error("capId not found: "+n.getErrorMessage())),s||(a=aa.env.getValue("CapID"))&&(a+="").length&&(r=a.split("-"),(n=aa.cap.getCapID(r[0],r[1],r[2])).getSuccess()?s=n.getOutput():Dpr.error("capId not found: "+n.getErrorMessage())),s||((n=aa.env.getValue("CapIdModel"))&&""!=n?s=n:Dpr.error("capId not found")),s);if(n){var s=getProjectType(n);if(s){s={user:t,capId:n,rawType:s};return e&&(e.taskName&&(s.taskName=e.taskName),e.taskStatus&&(s.taskStatus=e.taskStatus)),s}return null}return{user:t}}try{var a=aa.env.getValue("EventName")+"";if("V360InspectionResultSubmitAfter"==a)for(var r=aa.env.getValue("PermitId1Array"),n=aa.env.getValue("PermitId2Array"),i=aa.env.getValue("PermitId3Array"),o=aa.env.getValue("InspectionTypeArray"),u=aa.env.getValue("InspectionResultArray"),s=aa.env.getValue("InspectionIdArray"),p=0;p<r.length;p++){var c,l=aa.cap.getCapID(r[p],n[p],i[p]);l.getSuccess()&&(c=l.getOutput(),aa.env.setValue("PermitId1",c.getID1()),aa.env.setValue("PermitId2",c.getID2()),aa.env.setValue("PermitId3",c.getID3()),aa.env.setValue("InspectionId",s[p]),aa.env.setValue("InspectionType",o[p]),aa.env.setValue("InspectionResult",u[p]),(v=t(e))&&(Dpr.Actions||loadLibrary(),Dpr.Actions.invokeActionFromEvent(v)))}else if("ApplicationDeleteBefore"==a)for(var g=aa.env.getValue("CapIDList").toArray(),p=0;p<g.length;p++){var v,I=(g[p]+"").split("-");aa.env.setValue("PermitId1",I[0]),aa.env.setValue("PermitId2",I[1]),aa.env.setValue("PermitId3",I[2]),(v=t(e))&&(Dpr.Actions||loadLibrary(),Dpr.Actions.invokeActionFromEvent(v))}else(v=t(e))&&(Dpr.Actions||loadLibrary(),Dpr.Actions.invokeActionFromEvent(v))}catch(e){Dpr.error("Fire action failed: "+e.message+(e.stack?"\nStack: "+e.stack:""))}}Dpr.error=function(e){aa.debug("DPR",e)},Dpr.loadScript=loadScript,Dpr.isProject=isProject,Dpr.load=loadLibrary,Dpr.fireAction=fireAction}();