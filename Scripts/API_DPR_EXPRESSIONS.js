var Dpr={};!function(){var t,r=0;function a(e){for(var t={},r=e.split(";"),a=0;a<r.length;a++){var s=r[a].split("=");t[s[0]]=s[1]}return t}function s(e,t){t=aa.bizDomain.getBizDomainByValue(e,t);if(t.getSuccess()){t=t.getOutput();return"A"==t.getAuditStatus()+""?t.getDescription()+"":null}return null}function o(e,t){t=s(e,t);return t&&t.length?a(t):null}function n(e){if("string"==typeof e){var t=new Date(String(e));if(!t.toString().equals("Invalid Date"))return t}if("object"==typeof e){if(!e.getClass)return e;if(e.getClass().toString().equals("class com.accela.aa.emse.dom.ScriptDateTime"))return new Date(e.getMonth()+"/"+e.getDayOfMonth()+"/"+e.getYear());if(e.getClass().toString().equals("class com.accela.aa.emse.util.ScriptDateTime"))return new Date(e.getMonth()+"/"+e.getDayOfMonth()+"/"+e.getYear());if(e.getClass().toString().equals("class java.util.Date"))return new Date(e.getTime());if(e.getClass().toString().equals("class java.lang.String"))return new Date(String(e));if(e.getClass().toString().equals("class java.sql.Timestamp"))return new Date(e.getMonth()+"/"+e.getDate()+"/"+e.getYear())}return"number"==typeof e?new Date(e):(Dpr.log("Cannot parse date : "+e),null)}function i(e,t){var r=[],a=e.split("/");4!==a.length&&Dpr.log("The following cap type parameter is incorrectly formatted: "+e);t=aa.cap.getChildByMasterID(t);if(!t.getSuccess())return Dpr.log("getChildren returned an error: "+t.getErrorMessage()),null;for(var s=t.getOutput(),o=0;o<s.length;o++){for(var n=s[o].getCapID(),i=aa.cap.getCap(n).getOutput().getCapType().toString().split("/"),u=!0,g=0;g<i.length;g++)a[g].equals(i[g])||a[g].equals("*")||(u=!1);u&&r.push(n)}return Dpr.log("getChildren returned "+r.length+" capIds"),r}function u(e,t,r){e=aa.workflow.getTaskItems(e,t,"",null,null,null);if(e.getSuccess()){var a,s=e.getOutput();for(a in s){var o=s[a];if(o.getTaskDescription().toUpperCase().equals(t.toUpperCase()))return o}}else Dpr.log("Failed to get workflow object: "+e.getErrorMessage());return null}Dpr.addAdHocTask=function(e,t,r,a,s){(a=aa.person.getUser(a)).getSuccess()?((s=aa.workflow.getTasks(s).getOutput()[0].getTaskItem()).setProcessCode(e),s.setTaskDescription(t),s.setDispositionNote(r),s.setProcessID(0),s.setAssignmentDate(aa.util.now()),s.setDueDate(aa.util.now()),s.setAssignedUser(a.getOutput()),aa.proxyInvoker.newInstance("com.accela.aa.workflow.workflow.WorkflowBusiness").getOutput().createAdHocTaskItem(s)||Dpr.error("Unable to create AdHocTask")):Dpr.error("Could not find user to assign to in addAdHocTask")},Dpr.addCustomList=function(e,t,r,a,s){var o=aa.appSpecificTableScript.getAppSpecificTableModel(e,r);if(!o.getSuccess())return Dpr.error("**WARNING: error retrieving app specific table "+r+" "+o.getErrorMessage()),!1;var n,i=o.getOutput().getAppSpecificTableModel(),u=i.getTableField(),g=i.getReadonlyField();for(n in a){for(var p=i.getColumns().iterator();p.hasNext();){var l=p.next();a[n][l.getColumnName()]||(Dpr.log("addToASITable: null or undefined value supplied for column "+l.getColumnName()+", setting to empty string"),a[n][l.getColumnName()]=""),void 0!==a[n][l.getColumnName()].fieldValue?(u.add(a[n][l.getColumnName()].fieldValue),g.add(a[n][l.getColumnName()].readOnly)):(u.add(a[n][l.getColumnName()]),g.add(s))}i.setTableField(u),i.setReadonlyField(g)}return(t=aa.appSpecificTableScript.editAppSpecificTableInfos(i,e,t)).getSuccess()?void 0:(Dpr.log("**WARNING: error adding record to Custom List:  "+r+" "+t.getErrorMessage()),!1)},Dpr.addParent=function(e,t){return aa.cap.createAppHierarchy(t,e).getSuccess()},Dpr.assignTaskItem=function(e,t){e?(t=aa.person.getUser(t)).getSuccess()?(e.setAssignedUser(t.getOutput()),e=e.getTaskItem(),aa.workflow.assignTask(e)):Dpr.error("Could not find user to assign to in addAdHocTask"):Dpr.log("Unable to update task, no task provided")},Dpr.assignDepartmentTaskItem=function(e,t){var r;e?((r=aa.people.getSysUserModel()).setDeptOfUser(t),e.setAssignedUser(r),e=e.getTaskItem(),(e=aa.workflow.assignTask(e)).getSuccess()||Dpr.error("Error updating wfTask : "+e.getErrorMessage())):Dpr.log("Unable to update task, no task provided")},Dpr.capTypeMatch=function(e,t){var r=e.split("/"),a=t.split("/");if(4!==r.length||4!==a.length)return Dpr.error("Invalid match strings: "+e+"--"+t),!1;for(var s=0;s<a.length;s++)if(a[s].toUpperCase()!==r[s].toUpperCase()&&"*"!==a[s])return!1;return!0},Dpr.clearLastError=function(){t=void 0},Dpr.convertDate=n,Dpr.copyAddresses=function(e,t){var r,a,s=!1,o=aa.address.getAddressByCapId(t);if(!o.getSuccess())return Dpr.log("Failed to get addresses: "+o.getErrorMessage()),0;for(a in r=o.getOutput())if(r[a].getPrimaryFlag().equals("Y")){s=!0,Dpr.log("Target CAP has primary address");break}var n=0;if((o=aa.address.getAddressWithAttributeByCapId(e)).getSuccess())for(var i in r=o.getOutput())newAddress=r[i],newAddress.setCapID(t),s&&newAddress.setPrimaryFlag("N"),aa.address.createAddressWithAPOAttribute(t,newAddress),Dpr.log("Copied address from "+e.getCustomID()+" to "+t.getCustomID()),n++;else Dpr.log("Failed to get addresses: "+o.getErrorMessage());return n},Dpr.copyContacts=function(e,t){var r=aa.people.getCapContactByCapID(e),a=0;if(r.getSuccess()){var s,o=r.getOutput();for(s in o){var n=o[s].getCapContactModel(),i=aa.address.getContactAddressListByCapContact(n);i.getSuccess()&&(i=function(e){var t=null;if(e&&0<e.length)for(var r in t=aa.util.newArrayList(),e)t.add(e[r].getContactAddressModel());return t}(i.getOutput()),n.getPeople().setContactAddressList(i)),n.setCapID(t),aa.people.createCapContactWithAttribute(n),a++,Dpr.log("Copied contact from "+e.getCustomID()+" to "+t.getCustomID())}}else Dpr.log("Failed to get contacts: "+r.getErrorMessage());return a},Dpr.copyLicensedProf=function(e,t){var r=aa.licenseProfessional.getLicensedProfessionalsByCapID(e).getOutput();if(r)for(var a in r)r[a].setCapID(t),aa.licenseProfessional.createLicensedProfessional(r[a]),Dpr.log("Copied "+r[a].getLicenseNbr());else Dpr.log("No licensed professional on source")},Dpr.copyOwner=function(e,t){if((e=aa.owner.getOwnerByCapId(e)).getSuccess()){var r,a=e.getOutput();for(r in a)a[r].setCapID(t),aa.owner.createCapOwnerWithAPOAttribute(a[r]),Dpr.log("Copied Owner: "+a[r].getOwnerFullName())}else Dpr.log("Error Copying Owner : "+e.getErrorType()+" : "+e.getErrorMessage())},Dpr.copyParcels=function(e,t){var r=aa.parcel.getParcelandAttribute(e,null),a=0;if(!r.getSuccess())return Dpr.log("Failed to get parcels: "+r.getErrorMessage()),!1;var s,o=r.getOutput().toArray();for(s in o){var n=aa.parcel.getCapParcelModel().getOutput();n.setParcelModel(o[s]),n.setCapIDModel(t),n.setL1ParcelNo(o[s].getParcelNumber()),n.setParcelNo(o[s].getParcelNumber()),aa.parcel.createCapParcelWithAPOAttribute(n),Dpr.log("Copied parcel "+o[s].getParcelNumber()+" from "+e.getCustomID()+" to "+t.getCustomID()),a++}return a},Dpr.dateAdd=function(e,t){var r=3===arguments.length?!0:!1,a=e?n(e):new Date,s=0;if(r)for(;s<Math.abs(t);)a=0<t?new Date(aa.calendar.getNextWorkDay(aa.date.parseDate(a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear())).getOutput().getTime()):new Date(aa.calendar.getPreviousWorkDay(aa.date.parseDate(a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear())).getOutput().getTime()),s++;else a.setDate(a.getDate()+parseInt(t,10));return a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()},Dpr.deactivateTask=function(e,t){var r;(r=u(e,t))?(r=r,aa.workflow.adjustTask(e,r.getStepNumber(),"N",r.getCompleteFlag(),null,null)):Dpr.log(t+" was not found, unable to deactivate")},Dpr.editAppName=function(e,t){if((t=aa.cap.getCap(t)).getSuccess()){t=t.getOutput().getCapModel();t.setSpecialText(e);t=aa.cap.editCapByPK(t);if(!t.getSuccess())throw new Error("error setting cap name : "+t.getErrorMessage())}},Dpr.editTaskDueDate=function(e,t){e?(e.setDueDate(aa.date.parseDate(t)),e=e.getTaskItem(),aa.workflow.adjustTaskWithNoAudit(e)):Dpr.log("Unable to update task, no task provided")},Dpr.error=function(e){aa.log("DPR - "+e)},Dpr.getChildren=i,Dpr.getContacts=function(e){var t=[];if((e=aa.people.getCapContactByCapID(e)).getSuccess())for(var r=e.getOutput(),a=0;a<r.length;a++){var s=r[a].getPeople(),s={email:s.email?s.email+"":"",type:s.contactType+"",fullName:s.fullName?s.fullName+"":(s.getFirstName()?s.getFirstName():"")+" "+(s.getLastName()?s.getLastName():""),isPrimary:s.flag+""=="Y",contact:s};t.push(s)}return t},Dpr.getCustomField=function(e,t){if(t&&0<t.length){e=aa.appSpecificInfo.getByCapID(e);if(e.getSuccess()){for(var r=e.getOutput(),a=0;a<r.length;a++)if(r[a].getCheckboxDesc()+""===t)return r[a].getChecklistComment()?r[a].getChecklistComment()+"":r[a].getChecklistComment()}else Dpr.log("Error getting custom fields: "+e.getErrorMessage())}},Dpr.getCustomFields=function(e,t){var r=[];if((e=aa.appSpecificInfo.getByCapID(e)).getSuccess())for(var a,s,o=e.getOutput(),n=0;n<o.length;n++)(t&&Dpr.matches(o[n].getCheckboxDesc()+"",t)||!t)&&(a=o[n].getCheckboxDesc()+"",s=o[n].getChecklistComment()?o[n].getChecklistComment()+"":o[n].getChecklistComment(),r.push({name:a,value:s}));else Dpr.log("Error getting custom fields: "+e.getErrorMessage());return r},Dpr.setCustomField=function(e,t,r){var a;t&&0<t.length&&r&&0<r.toString().length&&((a=aa.appSpecificInfo.editSingleAppSpecific(e,t,r,null)).getSuccess()||Dpr.log("Failed to update "+t+" to a value of "+r+" for record "+e.getCustomID()+": "+a.getErrorMessage()))},Dpr.getTaskCustomFieldItem=function(e,t){if(e&&t&&0<t.length){var r=e.getStepNumber(),a=e.getProcessID(),a=aa.taskSpecificInfo.getTaskSpecifiInfoByDesc(e.getCapID(),a,r,t);if(a.getSuccess()){r=a.getOutput();if(r)return r.getChecklistComment()?r.getChecklistComment()+"":r.getChecklistComment();Dpr.log("No task custom field called "+t+" found for task "+e.getTaskDescription())}else Dpr.log("Unable to get task custom fields for "+e.getTaskDescription()+": "+a.getErrorMessage())}},Dpr.setTaskCustomFieldItem=function(e,t,r){var a,s,o;e&&t&&0<t.length&&r&&0<r.toString().length&&(o=e.getStepNumber(),s=e.getProcessID(),(a=aa.taskSpecificInfo.getTaskSpecifiInfoByDesc(e.getCapID(),s,o,t)).getSuccess()?(s=a.getOutput())?(o=[],taskCustomFieldModel=s.getTaskSpecificInfoModel(),taskCustomFieldModel.setChecklistComment(r),o.push(taskCustomFieldModel),taskCustomFieldUpdateResult=aa.taskSpecificInfo.editTaskSpecInfos(o),taskCustomFieldUpdateResult.getSuccess()||Dpr.error("Failed to update task custom field: "+taskCustomFieldUpdateResult.getErrorMessage())):Dpr.error("No task custom field called "+t+" found for task "+e.getTaskDescription()):Dpr.error("Unable to get task custom fields for "+e.getTaskDescription()+": "+a.getErrorMessage()))},Dpr.getLastError=function(){return t},Dpr.getNextRevisionNumber=function(e,t,r){for(var a=i(t,r),s=0,o=0;o<a.length;o++){var n=aa.cap.getCap(a[o]);!n.getSuccess()||(n=n.getOutput()).getCapClass().equals("COMPLETE")&&!n.getCapID().toString().equals(e.toString())&&-1<a[o].getCustomID().toString().indexOf(".")&&s++}return t=0,(t=s+1)<10?t="00"+t:9<t&&t<100&&(t="0"+t),r.getCustomID()+"."+t},Dpr.getParentRecord=function(e){var t=aa.cap.getProjectParents(e,1);if(t.getSuccess()){e=t.getOutput();return e.length?e[0].getCapID():null}return Dpr.log("Error getting project parents:  "+t.getErrorMessage()),null},Dpr.getProjectType=function(e){return o("DPR_RECORD_TYPES_ENABLED",e)},Dpr.getRecordWorkDescription=function(e){if((e=aa.cap.getCapWorkDesByPK(e)).getSuccess())return e.getOutput().getDescription()+""},Dpr.getTask=u,Dpr.getTasks=function(e,t,r,a){if((r=aa.workflow.getTaskItems(e,null,"",null,null,r?"Y":null)).getSuccess()){for(var s=[],o=r.getOutput(),n=0;n<o.length;n++)for(var i=o[n],u=0;u<t.length;u++)if(i.getTaskDescription().toUpperCase().equals(t[u].toUpperCase())){s.push(i);break}return s}return Dpr.log("Failed to get workflow object: "+r.getErrorMessage()),null},Dpr.getTaskStatusList=function(e,t,r){var a=[];if((r=aa.workflow.getTaskStatusList(e,t,r)).getSuccess()){var s,o=r.getOutput();for(s in o)a.push(o[s]+"");return a}throw new Error("Task status list could not be retrieved: "+r.getErrorMessage())},Dpr.getTaskUpdatedByUser=function(e,t){if((e=aa.workflow.getTaskItems(e,t,"",null,null,null)).getSuccess())for(var r in wfObj=e.getOutput(),wfObj){r=wfObj[r];if(r.getTaskDescription().toUpperCase().equals(t.toUpperCase()))return r.taskItem.sysUser}return!1},Dpr.getUserEmail=function(e){if(-1!==e.indexOf("PUBLICUSER")){if((r=aa.publicUser.getPublicUserByPUser(e)).getSuccess()){var t=r.getOutput();return t?t.email:null}return null}if((r=aa.person.getUser(e)).getSuccess()){var r=r.getOutput();return r?r.getEmail():null}return null},Dpr.getWorkDescription=function(e){return(e=aa.cap.getCapWorkDesByPK(e)).getSuccess()?(e=e.getOutput().getDescription())?e+"":"":(Dpr.log("Failed to get work description: "+e.getErrorMessage()),"")},Dpr.getRecordPrimaryAddress=function(e){var t=aa.address.getAddressByCapId(e).getOutput(),r={};if(0<t.length)for(var a in t)if(t[a].getPrimaryFlag()&&t[a].getPrimaryFlag().equals("Y")){r.address="";var s=t[a].getHouseNumberStart();null!==s&&0<s.toString().length()&&(r.address+=s);var o=t[a].getHouseFractionStart();null!==o&&0<o.length()&&(r.address+=" "+o);s=t[a].getHouseNumberEnd();null!==s&&0<s.toString().length()&&(r.address+=" - "+s);o=t[a].getHouseFractionEnd();null!==o&&0<o.length()&&(r.address+=" "+o);s=t[a].getStreetDirection();null!==s&&0<s.length()&&(r.address+=" "+s);o=t[a].getStreetName();null!==o&&0<o.length()&&(r.address+=" "+o);s=t[a].getStreetSuffix();null!==s&&0<s.length()&&(r.address+=" "+s);o=t[a].getStreetSuffixdirection();null!==o&&0<o.length()&&(r.address+=" "+o);s=t[a].getUnitType();null!==s&&0<s.length()&&(r.address+=" "+s+"#");o=t[a].getUnitStart(),s=t[a].getUnitEnd();null!==o&&0<o.length()?(r.address+=" "+o,null!==s&&0<s.length()&&(r.address+=" - "+s)):null!==s&&0<s.length()&&(r.address+=" "+s),null!==t[a].getZip()&&(r.zip=t[a].getZip()+""),null!==t[a].getCity()&&(r.city=t[a].getCity()+""),null!==t[a].getState()&&(r.state=t[a].getState()+"");break}return r},Dpr.getRecordPrimaryParcel=function(e,t){t=t||"Yes";var r="";if((e=aa.parcel.getParcelandAttribute(e,null))&&e.getSuccess())for(var a=e.getOutput().toArray(),s=0;s<a.length&&(r=a[s].getParcelNumber()+"","Yes"!==t||a[s].getPrimaryParcelFlag()+""!="Yes");s++);return r},Dpr.isTaskActive=function(e,t){return(t=u(e,t))&&t.getActiveFlag().equals("Y")},Dpr.log=function(e){0<r&&aa.log("DPR -"+e)},Dpr.getLogLevel=function(e){return r},Dpr.setLogLevel=function(e){r=e},Dpr.lookup=s,Dpr.lookupSetting=o,Dpr.matches=function(e,t){for(var r=0;r<t.length;r++)if(t[r]===e)return!0;return!1},Dpr.parseSetting=a,Dpr.removeCustomList=function(e,t,r){if(!(t=aa.appSpecificTableScript.removeAppSpecificTableInfos(r,e,t)).getSuccess())return Dpr.log("**WARNING: error removing ASI table "+r+" "+t.getErrorMessage()),!1},Dpr.runReport=function(e,t,r){try{if(!r.reportName)return Dpr.log("Report name must be provided."),!1;var a=r.reportName,s=aa.reportManager.getReportInfoModelByName(a);if(!s.getSuccess())return Dpr.log("Report not found: "+a),!1;var o=s.getOutput();if(r.module){o.setModule(r.module),o.setCapId(t),reportParamters=r.reportParamters||aa.util.newHashMap(),o.setReportParameters(r.reportParameters);var n=r.reportUser||e,i=aa.reportManager.hasPermission(a,n);if(!i.getSuccess()||!i.getOutput().booleanValue())return Dpr.log("The user "+n+" does not have permission for report called: "+a),!1;if(!(u=aa.reportManager.getReportResult(o)).getSuccess())return Dpr.log("Could not get report from report manager: "+u.getErrorMessage()),!1;var u=u.getOutput(),g=aa.reportManager.storeReportToDisk(u),p=g.getOutput();return g.getSuccess()?p:(Dpr.log("The appliation does not have permission to store this temporary report "+a+", error message please refer to:"+u.getErrorMessage()),!1)}}catch(e){return Dpr.log("Error running report. Error description: "+e.description),!1}},Dpr.scheduleInspection=function(e,t){var r=t.type,a=null,s=t.time||null,o=t.comment||"Scheduled via Script",n=t.daysAhead||0,n=Dpr.dateAdd(null,n);t.inspectorId&&0<t.inspectorId.length&&(a=(t=aa.person.getUser(t.inspectorId)).getSuccess()?t.getOutput():null),(o=aa.inspection.scheduleInspection(e,a,aa.date.parseDate(n),s,r,o)).getSuccess()?Dpr.log("Successfully scheduled inspection : "+r+" for "+n):Dpr.error("ERROR: adding scheduling inspection ("+r+"): "+o.getErrorMessage())},Dpr.sendEmail=function(e,t,r,a,s,o,n){var i,u;Dpr.log("Send to: "+r+". Template: "+s),(n=e?(i=e.ID1,u=e.ID2,e=e.ID3,e=aa.cap.createCapIDScriptModel(i,u,e),aa.document.sendEmailAndSaveAsDocument(t,r,a,s,o,e,n)):aa.document.sendEmailByTemplateName(t,r,a,s,o,n)).getSuccess()?Dpr.log("Sent email successfully!"):Dpr.log("Failed to send mail. - "+n.getErrorType())},Dpr.setLastError=function(e){t=e},Dpr.titleCase=function(e){for(var t=e.toLowerCase().split(" "),r=0;r<t.length;r++)t[r]=t[r].charAt(0).toUpperCase()+t[r].substring(1);return t.join(" ")},Dpr.triggerWtuaEvent=function(e,t,r,a,s){var o=new com.accela.aa.emse.emse.EMSEBusiness,n=aa.util.newHashtable(),i=e.toString().split("-");n.put("PermitId1",i[0]),n.put("PermitId2",i[1]),n.put("PermitId3",i[2]),n.put("CurrentUserID",t),n.put("WorkflowTask",r),n.put("WorkflowStatus",a),s||(r=Dpr.getTask(e,r))&&(s=r.getProcessID()+""),n.put("ProcessID",s),n.put("PROCESSCODE",s),o.handleEvent("WorkflowTaskUpdateAfter",aa.getServiceProviderCode(),n,t,null)},Dpr.updateRecordStatus=function(e,t,r,a){aa.cap.updateAppStatus(e,"APPLICATION",r,aa.date.getCurrentDate(),a,aa.person.getUser(t).getOutput())},Dpr.updateRecordWorkDescription=function(e,t){!(e=aa.cap.getCapWorkDesByPK(e)).getSuccess()||(e=e.getOutput())&&(workDesObj=e.getCapWorkDesModel(),workDesObj.setDescription(t),aa.cap.editCapWorkDes(workDesObj))},Dpr.updateTaskItem=function(e,t,r,a,s,o,n,i){i?aa.workflow.handleDisposition(e,r.getStepNumber(),a,aa.date.getCurrentDate(),o,s,aa.person.getUser(t).getOutput(),i):(r.setDisposition(a),r.setDispositionComment(s),r.setDispositionNote(o),r.setDispositionDate(aa.util.now()),r.setSysUser(aa.person.getUser(t).getOutput()),(r=r.getTaskItem()).setStatusDate(aa.util.now()),aa.workflow.handleDisposition(r,e))},Dpr.updateTask=function(e,t,r,a,s,o,n){var i=u(e,r);i?n?Dpr.updateTaskItem(e,t,i,a,s,o,"",n):Dpr.updateTaskItem(e,t,i,a,s,o):Dpr.log(r+" was not found, unable to update")},Dpr.setTaskRequired=function(e){var t,r,a=e.getCurrentTaskID()+"";"0"===a.charAt(5)&&(t=5,r="1",r=(a=a).substring(0,t)+r+a.substring(t+r.length),e.setCurrentTaskID(r),e=e.getTaskItem(),aa.workflow.adjustTaskWithNoAudit(e))},Dpr.zeroPad=function(e,t){for(var r=String(e);r.length<(t||2);)r="0"+r;return r},Dpr.getMatchingStatusForTask=function(e,t,r,a){for(var s=Dpr.getTaskStatusList(e,r,t),o=0;o<a.length;o++)if(Dpr.matches(a[o],s))return a[o];return null},Dpr.getUniqueNonEmptyItems=function(e,t,r){return e&&r.indexOf(e)===t},Dpr.findFirstMatch=function(e,t){for(var r=0;r<t.length;r++)if(e===t[r].name)return t[r]},Dpr.getDisciplineTasks=function(e){var t=[];if(e.task)t.push(e.task);else{if(!e.tasks)throw new Error("Either task or tasks mapping is required for discipline.");t=t.concat(e.tasks.split(","))}return t},Dpr.getLatestSubmittedPackage=function(e){var t=e.capId,r=Dpr.getAdminUser();if(0<(t=Dpr.getProjectSubmittals(r,t)).length){t=t.filter(function(e){return"SUBMITTED"===e.status.toUpperCase()});return 1===t.length?(t=t[0].id,e.submittalId=t):void 0}}}(),Dpr.Api={},function(){Dpr.Api.expression=function(){function setErrorEnvironment(e){aa.env.setValue("InterfaceReturnCode","1"),aa.env.setValue("InterfaceReturnMessage",e)}function loadParams(){for(var e={},t=aa.env.getParamValues().keys(),r=null;t.hasMoreElements();)(r=t.nextElement()).equals("name")||(e[r]=aa.env.getValue(r));return e}function loadScript(e){return e=e.toUpperCase(),aa.proxyInvoker.newInstance("com.accela.aa.emse.emse.EMSEBusiness").getOutput().getScriptByPK(aa.getServiceProviderCode(),e,"ADMIN").getScriptText()+""}try{var func=aa.env.getValue("name")+"";if(!func||0===func.length)return void setErrorEnvironment("No function submitted");var recordId=aa.env.getValue("project")+"";if(!recordId||0===recordId.length)return void setErrorEnvironment("Bad request, missing project id");var idArray=recordId.split("-"),result=aa.cap.getCapID(idArray[1],idArray[2],idArray[3]);if(!result.getSuccess())return void setErrorEnvironment("Bad request, Error retrieving capId");var parameters=loadParams();parameters.capId=result.getOutput(),Dpr.Expressions||eval(loadScript("INCLUDES_DPR_EXPRESSIONS")),Dpr.Expressions&&Dpr.Expressions[func]?(aa.env.setValue("returnValue",Dpr.Expressions[func](parameters)),aa.env.setValue("InterfaceReturnCode","0"),aa.env.setValue("InterfaceReturnMessage","Success")):setErrorEnvironment("<"+func+"> is not defined")}catch(error){Dpr.error("API failed with exception: "+error.message+(error.stack?"\nStack: "+error.stack:"")),setErrorEnvironment(error.message)}},Dpr.Api.expression()}();