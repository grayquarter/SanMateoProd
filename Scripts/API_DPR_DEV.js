function saveScript(e,t,r){var a=aa.proxyInvoker.newInstance("com.accela.aa.emse.emse.EMSEBusiness").getOutput(),n=aa.proxyInvoker.newInstance("com.accela.aa.emse.emse.ScriptDAOMSSQL").getOutput(),s=new Date,i=aa.proxyInvoker.newInstance("com.accela.aa.emse.emse.ScriptModel").getOutput(),o=!1;try{o=!a.getScriptByPK(aa.getServiceProviderCode(),e,r)}catch(e){aa.print("Error finding script: "+e),o=!0}i.setDescription(null),i.setServiceProviderCode(aa.getServiceProviderCode()),i.setScriptName(e),i.setScriptText(t),i.setSripteCode(e),i.setAuditID(r),i.setAuditDate(s),i.setAuditStatus("A"),o?(aa.print("Creating script: "+e),n.createScript(i)):(aa.print("Updating script: "+e),n.editScript(i))}function setErrorEnvironment(e){aa.env.setValue("InterfaceReturnCode","1"),aa.env.setValue("InterfaceReturnMessage",e)}function setSuccessEnvironment(e){aa.env.setValue("InterfaceReturnCode","0"),aa.env.setValue("InterfaceReturnMessage",e)}function deployScript(){try{var e=aa.env.getValue("id")+"";if(!e||0===e.length)return void setErrorEnvironment("Bad request, missing script id");var t=aa.env.getValue("text")+"";if(!t||0===t.length)return void setErrorEnvironment("Bad request, missing script text");var r=aa.getAuditID()+"";saveScript(e,t,r=!r||0===r.length?"ADMIN":r),(new com.accela.aa.emse.emse.EMSEBusiness).cleanScriptCache()}catch(e){aa.print("API failed with exception: "+e.message+(e.stack?"\nStack: "+e.stack:"")),setErrorEnvironment(e.message)}}function runTest(e,t){try{var r=new com.accela.aa.emse.emse.EMSEBusiness,a=aa.util.newHashtable();setSuccessEnvironment(r.testScript(e,aa.getServiceProviderCode(),a,t,!0))}catch(e){aa.print("API failed with exception: "+e.message+(e.stack?"\nStack: "+e.stack:"")),setErrorEnvironment(e.message)}}function testScript(){try{var e=aa.env.getValue("text")+"";if(!e||0===e.length)return void setErrorEnvironment("Bad request, missing test text");var t=aa.getAuditID()+"";runTest(e,t=!t||0===t.length?"ADMIN":t),(new com.accela.aa.emse.emse.EMSEBusiness).cleanScriptCache()}catch(e){aa.print("API failed with exception: "+e.message+(e.stack?"\nStack: "+e.stack:"")),setErrorEnvironment(e.message)}}function dprApi(){function loadScript(e){return e=e.toUpperCase(),aa.proxyInvoker.newInstance("com.accela.aa.emse.emse.EMSEBusiness").getOutput().getScriptByPK(aa.getServiceProviderCode(),e,"ADMIN").getScriptText()+""}try{var method=aa.env.getValue("method")+"";if(!method||0===method.length)return void setErrorEnvironment("Bad request, missing api method");var url=aa.env.getValue("url")+"";if(!url||0===url.length)return void setErrorEnvironment("Bad request, missing url");var payload=aa.env.getValue("payload")+"",payload=payload&&0!==payload.length?JSON.parse(payload):null,user=aa.getAuditID()+"",response;switch(user&&0!==user.length||(user="ADMIN"),eval(loadScript("INCLUDES_DPR_BOOT")),Dpr.load(),method){case"POST":response=Dpr.sendPost(Dpr.getEndpoint()+url,user,payload);break;case"PUT":response=Dpr.sendPut(Dpr.getEndpoint()+url,user,payload);break;case"GET":response=Dpr.sendGet(Dpr.getEndpoint()+url,user);break;case"DELETE":response=Dpr.sendDelete(Dpr.getEndpoint()+url,user);break;case"HEAD":response=Dpr.sendHead(Dpr.getEndpoint()+url,user)}var responseMessage=JSON.stringify(response);setSuccessEnvironment(responseMessage)}catch(error){aa.print("API failed with exception: "+error.message+(error.stack?"\nStack: "+error.stack:"")),setErrorEnvironment(error.message)}}function main(){var e=aa.env.getValue("action")+"";e&&0!==e.length?"deploy"==e?deployScript():"test"==e?testScript():"dprApi"==e?dprApi():setErrorEnvironment("Bad request, action sent does not match"):setErrorEnvironment("Bad request, missing action")}main();